<!DOCTYPE html>
<html lang="tr">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LEF98N9Q03"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-LEF98N9Q03');
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="T√ºrkiye'nin en kapsamlƒ± maa≈ü hesaplama platformu - Br√ºt/Net d√∂n√º≈ü√ºm, zam senaryolarƒ± ve tazminat hesaplamalarƒ±">
    <meta name="keywords" content="maa≈ü hesaplama, br√ºt net, vergi hesaplama, sgk, tazminat, zam hesaplama">
    <meta name="author" content="G√∂ksel">
    <meta name="theme-color" content="#6366f1">
    <title>Maa≈üƒ±nƒ± Hesapla by G√∂ksel - Akƒ±llƒ± Maa≈ü ve Zam Hesaplama Platformu</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="manifest" href="manifest.json">
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Tax Data -->
    <script src="assets/js/tax-data.js"></script>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap');
        
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f1f5f9;
            --gray: #64748b;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        /* Header */
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo {
            display: inline-flex;
            align-items: center;
            gap: 15px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 20px 40px;
            border-radius: 50px;
            margin-bottom: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .logo-icon {
            font-size: 2.5em;
        }
        
        .logo-text {
            color: white;
            font-size: 2em;
            font-weight: 800;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        /* Toolbar */
        .toolbar {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
        }
        
        .toolbar-left {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .toolbar-right {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-btn {
            padding: 12px 20px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--dark);
            transition: all 0.3s;
        }
        
        .dropdown-btn:hover {
            border-color: var(--primary);
            background: #f8fafc;
        }
        
        .dropdown-btn.active {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }
        
        .dropdown-icon {
            font-size: 1.2em;
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 5px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            min-width: 200px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .dropdown-content.show {
            display: block;
        }
        
        .dropdown-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .dropdown-item:hover {
            background: #f1f5f9;
        }
        
        .dropdown-item.selected {
            background: var(--primary);
            color: white;
        }
        
        .dropdown-item input[type="checkbox"] {
            margin-right: 8px;
        }
        
        /* Support Button */
        .support-btn {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }
        
        .support-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }
        
        /* Export Buttons */
        .export-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .export-pdf {
            background: #ef4444;
            color: white;
        }
        
        .export-excel {
            background: #10b981;
            color: white;
        }
        
        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }
        
        /* Main Card */
        .main-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        }
        
        /* Table */
        .calc-table-container {
            overflow-x: auto;
        }
        
        .calc-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .calc-table thead {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }
        
        .calc-table th,
        .calc-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            font-size: 14px;
        }
        
        .calc-table th {
            font-weight: 700;
            position: sticky;
            top: 0;
        }
        
        .calc-table tbody tr:hover {
            background: #f8fafc;
        }
        
        .calc-table input {
            width: 100%;
            padding: 8px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .calc-table input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .month-cell {
            font-weight: 700;
            color: var(--primary);
        }
        
        .total-row {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            font-weight: 700;
        }
        
        /* Side Panel */
        .side-panel {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 20px rgba(0, 0, 0, 0.1);
            transition: right 0.3s;
            z-index: 2000;
            overflow-y: auto;
            padding: 20px;
        }
        
        .side-panel.show {
            right: 0;
        }
        
        .side-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .close-panel {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }
        
        .panel-option {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .panel-option:hover {
            background: #f8fafc;
        }
        
        .panel-option input[type="checkbox"] {
            margin-right: 10px;
        }
        
        /* Summary Cards */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .summary-card {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
        }
        
        .summary-card-title {
            font-size: 0.9em;
            color: var(--gray);
            margin-bottom: 8px;
        }
        
        .summary-card-value {
            font-size: 1.8em;
            font-weight: 800;
            color: var(--dark);
        }
        
        /* Card View */
        .card-view-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .month-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .month-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        
        .month-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .month-card-title {
            font-size: 1.2em;
            font-weight: 700;
            color: var(--dark);
        }
        
        .month-card-number {
            background: var(--primary);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9em;
        }
        
        .month-card-input-group {
            margin-bottom: 15px;
        }
        
        .month-card-label {
            font-size: 0.85em;
            color: var(--gray);
            margin-bottom: 5px;
            display: block;
        }
        
        .month-card-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            transition: border-color 0.3s;
        }
        
        .month-card-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .month-card-detail {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .month-card-detail-label {
            font-size: 0.9em;
            color: var(--gray);
        }
        
        .month-card-detail-value {
            font-weight: 600;
            color: var(--dark);
        }
        
        .month-card-detail-value.sgk {
            color: #ef4444;
        }
        
        .month-card-detail-value.unemployment {
            color: #f97316;
        }
        
        .month-card-detail-value.tax {
            color: #dc2626;
        }
        
        .month-card-detail-value.stamp {
            color: #b91c1c;
        }
        
        .month-card-footer {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #e2e8f0;
        }
        
        .month-card-net {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .month-card-net-label {
            font-size: 1em;
            font-weight: 600;
            color: var(--dark);
        }
        
        .month-card-net-value {
            font-size: 1.4em;
            font-weight: 800;
            color: var(--success);
        }
        
        .month-card-maa≈ü {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #e2e8f0;
        }
        
        .month-card-maa≈ü-label {
            font-size: 0.9em;
            color: var(--gray);
        }
        
        .month-card-maa≈ü-value {
            font-size: 1.1em;
            font-weight: 700;
            color: var(--primary);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .toolbar {
                flex-direction: column;
            }
            
            .toolbar-left,
            .toolbar-right {
                width: 100%;
                justify-content: center;
            }
            
            .side-panel {
                width: 100%;
                right: -100%;
            }
            
            .card-view-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <span class="logo-icon">üí∞</span>
                <h1 class="logo-text">Maa≈üƒ±nƒ± Hesapla <span style="font-size: 0.6em; font-weight: 400; opacity: 0.9;">by G√∂ksel</span></h1>
            </div>
        </header>

        <!-- Toolbar -->
        <div class="toolbar">
            <div class="toolbar-left">
                <!-- Calculation Direction -->
                <div class="dropdown">
                    <button class="dropdown-btn" onclick="toggleDropdown('calc-direction')">
                        <span class="dropdown-icon">üîÑ</span>
                        <span id="calc-direction-text">Br√ºtten Nete</span>
                        <span>‚ñº</span>
                    </button>
                    <div class="dropdown-content" id="calc-direction">
                        <div class="dropdown-item" onclick="selectDirection('brut-to-net')">Br√ºtten Nete</div>
                        <div class="dropdown-item" onclick="selectDirection('net-to-brut')">Netten Br√ºte</div>
                    </div>
                </div>

                <!-- Year -->
                <div class="dropdown">
                    <button class="dropdown-btn" onclick="toggleDropdown('year-select')">
                        <span class="dropdown-icon">üìÖ</span>
                        <span id="year-text">2025</span>
                        <span>‚ñº</span>
                    </button>
                    <div class="dropdown-content" id="year-select" style="max-height: 300px; overflow-y: auto;">
                        <div class="dropdown-item" onclick="selectYear(2017)">2017</div>
                        <div class="dropdown-item" onclick="selectYear(2018)">2018</div>
                        <div class="dropdown-item" onclick="selectYear(2019)">2019</div>
                        <div class="dropdown-item" onclick="selectYear(2020)">2020</div>
                        <div class="dropdown-item" onclick="selectYear(2021)">2021</div>
                        <div class="dropdown-item" onclick="selectYear(2022)">2022</div>
                        <div class="dropdown-item" onclick="selectYear(2023)">2023</div>
                        <div class="dropdown-item" onclick="selectYear(2024)">2024</div>
                        <div class="dropdown-item selected" onclick="selectYear(2025)">2025</div>
                        <div class="dropdown-item" onclick="selectYear(2026)">2026</div>
                        <div class="dropdown-item" onclick="selectYear(2027)">2027</div>
                        <div class="dropdown-item" onclick="selectYear(2028)">2028</div>
                        <div class="dropdown-item" onclick="selectYear(2029)">2029</div>
                        <div class="dropdown-item" onclick="selectYear(2030)">2030</div>
                    </div>
                </div>

                <!-- View Mode -->
                <div class="dropdown">
                    <button class="dropdown-btn" onclick="toggleDropdown('view-mode')">
                        <span class="dropdown-icon">üìä</span>
                        <span id="view-text">Tablo</span>
                        <span>‚ñº</span>
                    </button>
                    <div class="dropdown-content" id="view-mode">
                        <div class="dropdown-item selected" onclick="selectView('table')">Tablo G√∂r√ºn√ºm√º</div>
                        <div class="dropdown-item" onclick="selectView('card')">Kart G√∂r√ºn√ºm√º</div>
                    </div>
                </div>

                <!-- Currency -->
                <div class="dropdown">
                    <button class="dropdown-btn" onclick="toggleDropdown('currency-select')">
                        <span class="dropdown-icon">üí±</span>
                        <span id="currency-text">TL</span>
                        <span>‚ñº</span>
                    </button>
                    <div class="dropdown-content" id="currency-select">
                        <div class="dropdown-item selected" onclick="selectCurrency('TL', '‚Ç∫')">üáπüá∑ TL</div>
                        <div class="dropdown-item" onclick="selectCurrency('USD', '$')">üá∫üá∏ USD</div>
                        <div class="dropdown-item" onclick="selectCurrency('EUR', '‚Ç¨')">üá™üá∫ EUR</div>
                    </div>
                </div>
            </div>

            <div class="toolbar-right">
                <!-- Zam Senaryolarƒ± -->
                <a href="zam-senaryolari.html" class="export-btn" style="background: linear-gradient(135deg, #3b82f6, #2563eb); text-decoration: none;">
                    <span>üìä</span>
                    <span>Zam Senaryolarƒ±</span>
                </a>
                
                <!-- Asgari √úcret Hesaplama -->
                <a href="asgari-ucret.html" class="export-btn" style="background: linear-gradient(135deg, #10b981, #059669); text-decoration: none;">
                    <span>üí∞</span>
                    <span>Asgari √úcret</span>
                </a>
                
                <!-- Tazminat Hesaplama -->
                <a href="tazminat-hesaplama.html" class="export-btn" style="background: linear-gradient(135deg, #8b5cf6, #6366f1); text-decoration: none;">
                    <span>üíº</span>
                    <span>Tazminat Hesapla</span>
                </a>
                
                <!-- Export Buttons -->
                <button class="export-btn export-pdf" onclick="exportToPDF()">
                    <span>üìÑ</span>
                    <span>PDF ƒ∞ndir</span>
                </button>
                <button class="export-btn export-excel" onclick="exportToExcel()">
                    <span>üìä</span>
                    <span>Excel ƒ∞ndir</span>
                </button>

                <!-- Support Button -->
                <button class="support-btn">
                    <span>‚òï</span>
                    <span>Bize Destek Olun</span>
                </button>

                <!-- Advanced Options -->
                <button class="dropdown-btn" onclick="toggleSidePanel()">
                    <span class="dropdown-icon">‚öôÔ∏è</span>
                    <span>Geli≈ümi≈ü</span>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-card">
            <h2 style="color: var(--dark); margin-bottom: 20px;">Br√ºtten Nete Maa≈ü Hesaplama 2025</h2>

            <!-- Summary Cards -->
            <div class="summary-cards">
                <div class="summary-card">
                    <div class="summary-card-title">Toplam Yƒ±llƒ±k Br√ºt</div>
                    <div class="summary-card-value" id="total-brut">0‚Ç∫</div>
                </div>
                <div class="summary-card">
                    <div class="summary-card-title">Toplam Yƒ±llƒ±k Net</div>
                    <div class="summary-card-value" id="total-net">0‚Ç∫</div>
                </div>
                <div class="summary-card">
                    <div class="summary-card-title">Toplam Kesintiler</div>
                    <div class="summary-card-value" id="total-deductions">0‚Ç∫</div>
                </div>
                <div class="summary-card">
                    <div class="summary-card-title">Ortalama Aylƒ±k Net</div>
                    <div class="summary-card-value" id="avg-net">0‚Ç∫</div>
                </div>
            </div>

            <!-- Card View (hidden by default) -->
            <div class="card-view-container" id="card-view" style="display: none;">
                <!-- Will be filled by JavaScript -->
            </div>

            <!-- Monthly Table -->
            <div class="calc-table-container" id="table-view">
                <table class="calc-table" id="monthly-table">
                    <thead>
                        <tr>
                            <th>Ay</th>
                            <th>Br√ºt √úcret</th>
                            <th>SGK ƒ∞≈ü√ßi (%14)</th>
                            <th>ƒ∞≈üsizlik (%1)</th>
                            <th>Vergi Matrahƒ±</th>
                            <th>Gelir Vergisi</th>
                            <th>Damga Vergisi</th>
                            <th>Net √úcret</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- Will be filled by JavaScript -->
                    </tbody>
                    <tfoot>
                        <tr class="total-row">
                            <td><strong>TOPLAM</strong></td>
                            <td id="footer-brut"><strong>0‚Ç∫</strong></td>
                            <td id="footer-sgk"><strong>0‚Ç∫</strong></td>
                            <td id="footer-unemployment"><strong>0‚Ç∫</strong></td>
                            <td id="footer-base"><strong>0‚Ç∫</strong></td>
                            <td id="footer-tax"><strong>0‚Ç∫</strong></td>
                            <td id="footer-stamp"><strong>0‚Ç∫</strong></td>
                            <td id="footer-net"><strong>0‚Ç∫</strong></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <!-- Side Panel -->
    <div class="side-panel" id="side-panel">
        <div class="side-panel-header">
            <h3>Geli≈ümi≈ü Se√ßenekler</h3>
            <button class="close-panel" onclick="toggleSidePanel()">‚úï</button>
        </div>

        <div class="panel-option">
            <input type="checkbox" id="opt-bonus" onchange="toggleAdvancedOption('bonus', this.checked)">
            <label for="opt-bonus">ƒ∞kramiye, Prim, Yol, Yemek Toplamƒ±</label>
        </div>

        <div class="panel-option">
            <input type="checkbox" id="opt-sgk-deduct" onchange="toggleAdvancedOption('sgkDeduct', this.checked)">
            <label for="opt-sgk-deduct">SGK Matrahƒ±ndan D√º≈ü</label>
        </div>

        <div class="panel-option">
            <input type="checkbox" id="opt-stamp-deduct" onchange="toggleAdvancedOption('stampDeduct', this.checked)">
            <label for="opt-stamp-deduct">Damga V. Matrahƒ±ndan D√º≈ü</label>
        </div>

        <div class="panel-option">
            <input type="checkbox" id="opt-tax-deduct" onchange="toggleAdvancedOption('taxDeduct', this.checked)">
            <label for="opt-tax-deduct">Gelir V. Matrahƒ±ndan D√º≈ü</label>
        </div>

        <div class="panel-option">
            <input type="checkbox" id="opt-net-deduct" onchange="toggleAdvancedOption('netDeduct', this.checked)">
            <label for="opt-net-deduct">Netten D√º≈ü (Otomatik BES, ...)</label>
        </div>

        <div class="panel-option">
            <input type="checkbox" id="opt-net-additions" onchange="toggleAdvancedOption('netAdditions', this.checked)">
            <label for="opt-net-additions">Net ƒ∞laveler</label>
        </div>

        <div class="panel-option">
            <input type="checkbox" id="opt-cumulative" onchange="toggleAdvancedOption('cumulative', this.checked)">
            <label for="opt-cumulative">K√ºm√ºlatif Gelir Vergisi Matrahƒ±</label>
        </div>

        <div class="panel-option">
            <input type="checkbox" id="opt-totals" checked onchange="toggleAdvancedOption('totals', this.checked)">
            <label for="opt-totals">Toplamlar G√∂ster</label>
        </div>
        
        <hr style="margin: 20px 0; border: none; border-top: 1px solid #e2e8f0;">
        
        <h4 style="margin-bottom: 15px; color: var(--dark);">√áalƒ±≈üan Bilgileri</h4>
        
        <div class="panel-option">
            <label style="display: block; margin-bottom: 10px; font-weight: 600;">√áalƒ±≈üan Tipi</label>
            <select id="employee-type" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px;" onchange="handleEmployeeTypeChange(this.value)">
                <option value="normal">Normal √áalƒ±≈üan</option>
                <option value="retired">Emekli √áalƒ±≈üan</option>
                <option value="disabled-1">1. Derece Engelli</option>
                <option value="disabled-2">2. Derece Engelli</option>
                <option value="disabled-3">3. Derece Engelli</option>
            </select>
        </div>
        
        <div class="panel-option">
            <input type="checkbox" id="opt-agi" onchange="toggleAdvancedOption('agi', this.checked)">
            <label for="opt-agi">Asgari Ge√ßim ƒ∞ndirimi (AGƒ∞)</label>
        </div>
        
        <div class="panel-option" id="agi-settings" style="display: none; margin-left: 25px;">
            <label style="display: block; margin-bottom: 5px; font-size: 0.9em;">Medeni Durum</label>
            <select id="marital-status" style="width: 100%; padding: 8px; border: 2px solid #e2e8f0; border-radius: 8px; margin-bottom: 10px;">
                <option value="single">Bekar</option>
                <option value="married">Evli</option>
            </select>
            
            <label style="display: block; margin-bottom: 5px; font-size: 0.9em;">√áocuk Sayƒ±sƒ±</label>
            <input type="number" id="child-count" min="0" max="10" value="0" 
                   style="width: 100%; padding: 8px; border: 2px solid #e2e8f0; border-radius: 8px;"
                   placeholder="√áocuk sayƒ±sƒ±">
        </div>
    </div>

    <script>
        // Exchange rates
        const exchangeRates = {
            USD: 42.70,
            EUR: 50.16,
            TL: 1
        };

        let currentCurrency = 'TL';
        let currencySymbol = '‚Ç∫';
        let currentYear = 2025;
        let calculationDirection = 'brut-to-net';

        // Months
        const months = [
            'Ocak', '≈ûubat', 'Mart', 'Nisan', 'Mayƒ±s', 'Haziran',
            'Temmuz', 'Aƒüustos', 'Eyl√ºl', 'Ekim', 'Kasƒ±m', 'Aralƒ±k'
        ];

        // Advanced options state
        const advancedOptions = {
            bonus: false,
            sgkDeduct: false,
            stampDeduct: false,
            taxDeduct: false,
            netDeduct: false,
            netAdditions: false,
            cumulative: false,
            totals: true,
            agi: true  // AGƒ∞ varsayƒ±lan olarak a√ßƒ±k
        };
        
        // Employee settings
        let employeeType = 'normal'; // normal, retired, disabled-1, disabled-2, disabled-3
        let maritalStatus = 'single';
        let childCount = 0;
        
        // AGI 2025 rates (√∂rnek deƒüerler - ger√ßek deƒüerleri kullanƒ±n)
        const agiRates = {
            single: 0.50,      // Bekar i√ßin %50 indirim
            married: 0.60,     // Evli i√ßin %60 indirim
            perChild: 0.075    // √áocuk ba≈üƒ±na ek %7.5
        };
        
        // Tax rates by employee type
        function getTaxMultiplier() {
            switch(employeeType) {
                case 'retired': return 0.85;  // Emekliler i√ßin %15 indirim
                case 'disabled-1': return 0.80; // 1. derece %20 indirim
                case 'disabled-2': return 0.85; // 2. derece %15 indirim
                case 'disabled-3': return 0.90; // 3. derece %10 indirim
                default: return 1.0;
            }
        }
        
        // Calculate AGI
        function calculateAGI(taxBase) {
            if (!advancedOptions.agi) return 0;
            
            const yearData = getYearData(currentYear);
            let agiRate = maritalStatus === 'married' ? yearData.agi.married : yearData.agi.single;
            agiRate += childCount * yearData.agi.perChild;
            agiRate = Math.min(agiRate, 1.0); // Max %100
            
            const minimumWage = yearData.minWage;
            const agiAmount = minimumWage * 0.15 * agiRate; // Vergi matrahƒ±nƒ±n %15'i √ºzerinden
            
            return Math.min(agiAmount, taxBase * 0.15);
        }
        
        // Handle employee type change
        function handleEmployeeTypeChange(type) {
            employeeType = type;
            
            // Recalculate all rows
            for (let i = 0; i < 12; i++) {
                calculateRow(i);
            }
        }

        // Initialize table with dynamic columns
        function initTable() {
            const thead = document.querySelector('#monthly-table thead');
            const tbody = document.getElementById('table-body');
            const tfoot = document.querySelector('#monthly-table tfoot tr');
            
            // Clear existing
            thead.innerHTML = '';
            tbody.innerHTML = '';
            
            // Detaylƒ± tablo ba≈ülƒ±klarƒ± (brutmaas.net benzeri) - ƒ∞lk satƒ±r
            const theadRow1 = document.createElement('tr');
            theadRow1.innerHTML = `
                <th rowspan="2">Ay</th>
                <th rowspan="2">Br√ºt √úcret</th>
                ${advancedOptions.bonus ? '<th rowspan="2">ƒ∞kramiye/Prim/<br>Yol Yemek Toplamƒ±</th>' : ''}
                <th colspan="2" style="background: #e0f2fe; color: #0369a1;">SGK + ƒ∞≈üsizlik</th>
                ${advancedOptions.sgkDeduct ? '<th rowspan="2">SGK Matrahƒ±ndan<br>D√º≈ü</th>' : ''}
                <th rowspan="2">Vergi<br>Matrahƒ±</th>
                ${advancedOptions.cumulative ? '<th rowspan="2">K√ºm√ºlatif<br>Matrah</th>' : ''}
                <th colspan="5" style="background: #fee2e2; color: #991b1b;">Gelir Vergisi Dilimleri</th>
                ${advancedOptions.agi ? '<th rowspan="2">AGƒ∞</th>' : ''}
                ${advancedOptions.taxDeduct ? '<th rowspan="2">Gelir V. Matrahƒ±ndan<br>D√º≈ü</th>' : ''}
                <th rowspan="2">Toplam<br>Gelir Vergisi</th>
                ${advancedOptions.stampDeduct ? '<th rowspan="2">Damga V. Matrahƒ±ndan<br>D√º≈ü</th>' : ''}
                <th rowspan="2">Damga<br>Vergisi</th>
                ${advancedOptions.netDeduct ? '<th rowspan="2">Netten D√º≈ü<br>(BES vb.)</th>' : ''}
                ${advancedOptions.netAdditions ? '<th rowspan="2">Net<br>ƒ∞laveler</th>' : ''}
                <th rowspan="2">Net √úcret</th>
            `;
            thead.appendChild(theadRow1);
            
            // ƒ∞kinci satƒ±r ba≈ülƒ±klar
            const theadRow2 = document.createElement('tr');
            theadRow2.innerHTML = `
                <th style="background: #e0f2fe; color: #0369a1; font-size: 0.85em;">√áalƒ±≈üan<br>SGK (%14)</th>
                <th style="background: #e0f2fe; color: #0369a1; font-size: 0.85em;">ƒ∞≈üsizlik<br>Sigortasƒ± (%1)</th>
                <th style="background: #fef3c7; color: #92400e; font-size: 0.85em;">%15<br>Dilimi</th>
                <th style="background: #fed7aa; color: #9a3412; font-size: 0.85em;">%20<br>Dilimi</th>
                <th style="background: #fecaca; color: #991b1b; font-size: 0.85em;">%27<br>Dilimi</th>
                <th style="background: #fca5a5; color: #7f1d1d; font-size: 0.85em;">%35<br>Dilimi</th>
                <th style="background: #f87171; color: #7f1d1d; font-size: 0.85em;">%40<br>Dilimi</th>
            `;
            thead.appendChild(theadRow2);
            
            // Footer
            tfoot.innerHTML = `
                <td><strong>TOPLAM</strong></td>
                <td id="footer-brut"><strong>0‚Ç∫</strong></td>
                ${advancedOptions.bonus ? '<td id="footer-bonus"><strong>0‚Ç∫</strong></td>' : ''}
                <td id="footer-sgk"><strong>0‚Ç∫</strong></td>
                <td id="footer-unemployment"><strong>0‚Ç∫</strong></td>
                ${advancedOptions.sgkDeduct ? '<td id="footer-sgk-deduct"><strong>0‚Ç∫</strong></td>' : ''}
                <td id="footer-base"><strong>0‚Ç∫</strong></td>
                ${advancedOptions.cumulative ? '<td id="footer-cumulative"><strong>0‚Ç∫</strong></td>' : ''}
                <td id="footer-tax15"><strong>0‚Ç∫</strong></td>
                <td id="footer-tax20"><strong>0‚Ç∫</strong></td>
                <td id="footer-tax27"><strong>0‚Ç∫</strong></td>
                <td id="footer-tax35"><strong>0‚Ç∫</strong></td>
                <td id="footer-tax40"><strong>0‚Ç∫</strong></td>
                ${advancedOptions.agi ? '<td id="footer-agi"><strong>0‚Ç∫</strong></td>' : ''}
                ${advancedOptions.taxDeduct ? '<td id="footer-tax-deduct"><strong>0‚Ç∫</strong></td>' : ''}
                <td id="footer-tax"><strong>0‚Ç∫</strong></td>
                ${advancedOptions.stampDeduct ? '<td id="footer-stamp-deduct"><strong>0‚Ç∫</strong></td>' : ''}
                <td id="footer-stamp"><strong>0‚Ç∫</strong></td>
                ${advancedOptions.netDeduct ? '<td id="footer-net-deduct"><strong>0‚Ç∫</strong></td>' : ''}
                ${advancedOptions.netAdditions ? '<td id="footer-net-additions"><strong>0‚Ç∫</strong></td>' : ''}
                <td id="footer-net"><strong>0‚Ç∫</strong></td>
            `;

            // Create rows
            months.forEach((month, index) => {
                const row = document.createElement('tr');
                const inputPlaceholder = calculationDirection === 'brut-to-net' ? '26005.50' : '18591.59';
                const inputLabel = calculationDirection === 'brut-to-net' ? 'Br√ºt' : 'Net';
                
                // Ocak ayƒ± i√ßin √∂zel oninput handler
                const inputHandler = index === 0 ? `copyToAllMonths(0); calculateRow(0);` : `calculateRow(${index})`;
                
                let rowHTML = `
                    <td class="month-cell">${index + 1}. ${month}</td>
                    <td><input type="number" id="brut-${index}" placeholder="${inputPlaceholder}" oninput="${inputHandler}" title="${inputLabel} √úcret Girin"></td>
                `;

                if (advancedOptions.bonus) {
                    rowHTML += `<td><input type="number" id="bonus-${index}" placeholder="0" oninput="calculateRow(${index})"></td>`;
                }

                rowHTML += `<td id="sgk-${index}">0${currencySymbol}</td>`;
                rowHTML += `<td id="unemployment-${index}">0${currencySymbol}</td>`;
                
                if (advancedOptions.sgkDeduct) {
                    rowHTML += `<td><input type="number" id="sgk-deduct-${index}" placeholder="0" oninput="calculateRow(${index})"></td>`;
                }
                
                rowHTML += `<td id="base-${index}">0${currencySymbol}</td>`;

                if (advancedOptions.cumulative) {
                    rowHTML += `<td id="cumulative-${index}">0${currencySymbol}</td>`;
                }

                // 5 ayrƒ± vergi dilimi s√ºtunu
                rowHTML += `<td id="tax15-${index}" style="background: #fef3c7; font-size: 0.9em;">0${currencySymbol}</td>`;
                rowHTML += `<td id="tax20-${index}" style="background: #fed7aa; font-size: 0.9em;">0${currencySymbol}</td>`;
                rowHTML += `<td id="tax27-${index}" style="background: #fecaca; font-size: 0.9em;">0${currencySymbol}</td>`;
                rowHTML += `<td id="tax35-${index}" style="background: #fca5a5; font-size: 0.9em;">0${currencySymbol}</td>`;
                rowHTML += `<td id="tax40-${index}" style="background: #f87171; font-size: 0.9em;">0${currencySymbol}</td>`;
                
                if (advancedOptions.agi) {
                    rowHTML += `<td id="agi-${index}">0${currencySymbol}</td>`;
                }
                
                if (advancedOptions.taxDeduct) {
                    rowHTML += `<td><input type="number" id="tax-deduct-${index}" placeholder="0" oninput="calculateRow(${index})"></td>`;
                }
                
                rowHTML += `<td id="tax-${index}">0${currencySymbol}</td>`;
                
                if (advancedOptions.stampDeduct) {
                    rowHTML += `<td><input type="number" id="stamp-deduct-${index}" placeholder="0" oninput="calculateRow(${index})"></td>`;
                }
                
                rowHTML += `<td id="stamp-${index}">0${currencySymbol}</td>`;
                
                if (advancedOptions.netDeduct) {
                    rowHTML += `<td><input type="number" id="net-deduct-${index}" placeholder="0" oninput="calculateRow(${index})"></td>`;
                }
                
                if (advancedOptions.netAdditions) {
                    rowHTML += `<td><input type="number" id="net-additions-${index}" placeholder="0" oninput="calculateRow(${index})"></td>`;
                }
                
                rowHTML += `<td id="net-${index}"><strong>0${currencySymbol}</strong></td>`;

                row.innerHTML = rowHTML;
                tbody.appendChild(row);
            });
        }

        // Calculate single row with advanced options
        function calculateRow(index) {
            if (calculationDirection === 'net-to-brut') {
                calculateNetToBrut(index);
            } else {
                calculateBrutToNet(index);
            }
        }
        
        // Ocak ayƒ±ndaki deƒüeri t√ºm bo≈ü aylara kopyala
        function copyToAllMonths(sourceIndex) {
            const sourceInput = document.getElementById(`brut-${sourceIndex}`);
            const sourceValue = sourceInput?.value;
            
            if (!sourceValue || sourceValue === '') return;
            
            // T√ºm diƒüer aylara kopyala (sadece bo≈ü olanlara)
            for (let i = 1; i < 12; i++) {
                const targetInput = document.getElementById(`brut-${i}`);
                if (targetInput) {
                    // Sadece bo≈ü olan veya deƒüeri olmayan alanlara yaz
                    // Kullanƒ±cƒ± manuel deƒüi≈ütirdiyse dokunma
                    if (!targetInput.value || targetInput.value === '' || !targetInput.hasAttribute('data-manual-edit')) {
                        targetInput.value = sourceValue;
                        calculateRow(i);
                    }
                }
            }
        }
        
        // Manuel d√ºzenleme takibi i√ßin event listener ekle
        function initManualEditTracking() {
            for (let i = 1; i < 12; i++) {
                const input = document.getElementById(`brut-${i}`);
                if (input) {
                    input.addEventListener('focus', function() {
                        // Kullanƒ±cƒ± bu alana odaklandƒ±ƒüƒ±nda manuel d√ºzenleme bayraƒüƒ± ekle
                        this.setAttribute('data-manual-edit', 'true');
                    });
                }
            }
        }
        
        // Vergi dilimlerini hesapla - Global fonksiyon
        function calculateTaxBrackets(taxBase) {
            const yearData = getYearData(currentYear);
            const brackets = {
                tax15: 0,
                tax20: 0,
                tax27: 0,
                tax35: 0,
                tax40: 0,
                total: 0
            };
            
            const taxBracketsData = yearData.taxBrackets;
            
            // Her dilimi hesapla
            for (let i = 0; i < taxBracketsData.length; i++) {
                const bracket = taxBracketsData[i];
                const bracketMin = bracket.min;
                const bracketMax = bracket.max;
                const bracketRate = bracket.rate;
                
                // Bu dilimde vergiye tabi tutar
                if (taxBase > bracketMin) {
                    const taxableInBracket = Math.min(taxBase, bracketMax) - bracketMin;
                    const taxAmount = taxableInBracket * bracketRate;
                    
                    // Doƒüru dilime ata
                    if (bracketRate === 0.15) {
                        brackets.tax15 += taxAmount;
                    } else if (bracketRate === 0.20) {
                        brackets.tax20 += taxAmount;
                    } else if (bracketRate === 0.27) {
                        brackets.tax27 += taxAmount;
                    } else if (bracketRate === 0.35) {
                        brackets.tax35 += taxAmount;
                    } else if (bracketRate === 0.40) {
                        brackets.tax40 += taxAmount;
                    }
                }
            }
            
            brackets.total = brackets.tax15 + brackets.tax20 + brackets.tax27 + brackets.tax35 + brackets.tax40;
            return brackets;
        }
        
        // BU AYIN matrahƒ±nƒ±n dilim ge√ßi≈üini hesapla (INCREMENTAL)
        function calculateIncrementalTax(previousCumulativeBase, currentMonthBase) {
            const yearData = getYearData(currentYear);
            const taxBracketsData = yearData.taxBrackets;
            const totalCumulative = previousCumulativeBase + currentMonthBase;
            
            let tax = 0;
            let remainingAmount = currentMonthBase;
            
            const brackets = {
                tax15: 0,
                tax20: 0,
                tax27: 0,
                tax35: 0,
                tax40: 0
            };
            
            // Her dilimi kontrol et
            for (const bracket of taxBracketsData) {
                if (remainingAmount <= 0) break;
                
                // Bu dilimde ne kadar yer var? (√∂nceki k√ºm√ºlatif matraha g√∂re)
                const spaceInBracket = Math.max(0, bracket.max - Math.max(bracket.min, previousCumulativeBase));
                
                if (spaceInBracket > 0 && totalCumulative > bracket.min) {
                    // Bu ayƒ±n ne kadarƒ± bu dilime giriyor?
                    const amountInThisBracket = Math.min(remainingAmount, spaceInBracket);
                    const taxInBracket = amountInThisBracket * bracket.rate;
                    tax += taxInBracket;
                    
                    // Dilime g√∂re kaydet
                    if (bracket.rate === 0.15) {
                        brackets.tax15 = taxInBracket;
                    } else if (bracket.rate === 0.20) {
                        brackets.tax20 = taxInBracket;
                    } else if (bracket.rate === 0.27) {
                        brackets.tax27 = taxInBracket;
                    } else if (bracket.rate === 0.35) {
                        brackets.tax35 = taxInBracket;
                    } else if (bracket.rate === 0.40) {
                        brackets.tax40 = taxInBracket;
                    }
                    
                    remainingAmount -= amountInThisBracket;
                }
            }
            
            return {
                tax: tax,
                brackets: brackets
            };
        }
        
        // Br√ºtten Nete Hesaplama
        function calculateBrutToNet(index) {
            const brutInput = document.getElementById(`brut-${index}`).value;
            if (!brutInput) return;

            let brut = parseFloat(brutInput) * exchangeRates[currentCurrency];

            // Bonus additions
            let bonus = 0;
            if (advancedOptions.bonus) {
                const bonusInput = document.getElementById(`bonus-${index}`)?.value;
                if (bonusInput) {
                    bonus = parseFloat(bonusInput) * exchangeRates[currentCurrency];
                    brut += bonus;
                }
            }

            // SGK deductions
            let sgkDeduct = 0;
            if (advancedOptions.sgkDeduct) {
                const sgkDeductInput = document.getElementById(`sgk-deduct-${index}`)?.value;
                if (sgkDeductInput) {
                    sgkDeduct = parseFloat(sgkDeductInput) * exchangeRates[currentCurrency];
                }
            }

            const sgk = (brut - sgkDeduct) * 0.14;
            const unemployment = brut * 0.01;
            const base = brut - sgk - unemployment;

            // Vergi hesaplama - T√úRKƒ∞YE DOƒûRU Y√ñNTEM: "Dilim ge√ßi≈üi tek tek"
            let tax = 0;
            let taxBrackets = { tax15: 0, tax20: 0, tax27: 0, tax35: 0, tax40: 0 };
            
            // √ñnceki aylarƒ±n k√ºm√ºlatif matrahƒ±nƒ± hesapla
            let previousCumulativeBase = 0;
            for (let i = 0; i < index; i++) {
                const prevBaseText = document.getElementById(`base-${i}`)?.textContent;
                if (prevBaseText) {
                    const prevBase = parseFloat(prevBaseText.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.'));
                    if (!isNaN(prevBase)) {
                        previousCumulativeBase += prevBase * exchangeRates[currentCurrency];
                    }
                }
            }
            
            // BU AYIN matrahƒ±nƒ±n dilim ge√ßi≈üini hesapla (incremental)
            const incrementalResult = calculateIncrementalTax(previousCumulativeBase, base);
            tax = incrementalResult.tax;
            taxBrackets = incrementalResult.brackets;
            
            // Apply employee type tax reduction
            tax = tax * getTaxMultiplier();
            
            // Apply AGI (Asgari Ge√ßim ƒ∞ndirimi)
            let agiAmount = 0;
            if (advancedOptions.agi) {
                const agiBase = advancedOptions.cumulative ? base : base; // AGI always on current month base
                agiAmount = calculateAGI(agiBase);
                tax = Math.max(0, tax - agiAmount);
            }

            // Tax deductions
            let taxDeduct = 0;
            if (advancedOptions.taxDeduct) {
                const taxDeductInput = document.getElementById(`tax-deduct-${index}`)?.value;
                if (taxDeductInput) {
                    taxDeduct = parseFloat(taxDeductInput) * exchangeRates[currentCurrency];
                    tax = Math.max(0, tax - taxDeduct);
                }
            }

            // Stamp tax
            let stampDeduct = 0;
            if (advancedOptions.stampDeduct) {
                const stampDeductInput = document.getElementById(`stamp-deduct-${index}`)?.value;
                if (stampDeductInput) {
                    stampDeduct = parseFloat(stampDeductInput) * exchangeRates[currentCurrency];
                }
            }
            const stamp = Math.max(0, (brut - stampDeduct) * 0.00759);

            // Net calculation
            let net = base - tax - stamp;

            // Net deductions (BES, etc.)
            let netDeduct = 0;
            if (advancedOptions.netDeduct) {
                const netDeductInput = document.getElementById(`net-deduct-${index}`)?.value;
                if (netDeductInput) {
                    netDeduct = parseFloat(netDeductInput) * exchangeRates[currentCurrency];
                    net -= netDeduct;
                }
            }

            // Net additions
            let netAdditions = 0;
            if (advancedOptions.netAdditions) {
                const netAddInput = document.getElementById(`net-additions-${index}`)?.value;
                if (netAddInput) {
                    netAdditions = parseFloat(netAddInput) * exchangeRates[currentCurrency];
                    net += netAdditions;
                }
            }

            // Convert back to display currency and update UI
            const rate = exchangeRates[currentCurrency];
            document.getElementById(`sgk-${index}`).textContent = formatCurrency(sgk / rate);
            document.getElementById(`unemployment-${index}`).textContent = formatCurrency(unemployment / rate);
            document.getElementById(`base-${index}`).textContent = formatCurrency(base / rate);
            
            // Vergi dilimlerini ayrƒ± s√ºtunlarda g√∂ster
            document.getElementById(`tax15-${index}`).textContent = formatCurrency(taxBrackets.tax15 / rate);
            document.getElementById(`tax20-${index}`).textContent = formatCurrency(taxBrackets.tax20 / rate);
            document.getElementById(`tax27-${index}`).textContent = formatCurrency(taxBrackets.tax27 / rate);
            document.getElementById(`tax35-${index}`).textContent = formatCurrency(taxBrackets.tax35 / rate);
            document.getElementById(`tax40-${index}`).textContent = formatCurrency(taxBrackets.tax40 / rate);
            
            // AGƒ∞ g√∂ster
            if (advancedOptions.agi) {
                document.getElementById(`agi-${index}`).textContent = formatCurrency(agiAmount / rate);
            }
            
            document.getElementById(`tax-${index}`).textContent = formatCurrency(tax / rate);
            document.getElementById(`stamp-${index}`).textContent = formatCurrency(stamp / rate);
            document.getElementById(`net-${index}`).innerHTML = `<strong>${formatCurrency(net / rate)}</strong>`;

            if (advancedOptions.cumulative) {
                // Calculate cumulative base for display
                let cumulativeBaseForDisplay = base;
                for (let i = 0; i < index; i++) {
                    const prevBase = document.getElementById(`base-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                    if (prevBase) {
                        cumulativeBaseForDisplay += parseFloat(prevBase) * exchangeRates[currentCurrency];
                    }
                }
                document.getElementById(`cumulative-${index}`).textContent = formatCurrency(cumulativeBaseForDisplay / rate);
            }

            updateTotals();
        }
        
        // Netten Br√ºte Hesaplama (Iterative approach)
        function calculateNetToBrut(index) {
            const netInput = document.getElementById(`brut-${index}`).value; // Input field shows net in this mode
            if (!netInput) return;

            const targetNet = parseFloat(netInput) * exchangeRates[currentCurrency];
            
            // Use iterative method to find brut salary that gives target net
            let brutEstimate = targetNet * 1.45; // Start with estimate (net * 1.45)
            let iterations = 0;
            const maxIterations = 20;
            const tolerance = 0.01; // 1 kuru≈ü tolerance
            
            while (iterations < maxIterations) {
                // Calculate net from current brut estimate
                const sgk = brutEstimate * 0.14;
                const unemployment = brutEstimate * 0.01;
                const base = brutEstimate - sgk - unemployment;
                
                // Calculate tax
                let tax = 0;
                if (advancedOptions.cumulative) {
                    let cumulativeBase = base;
                    let previousTaxTotal = 0;
                    
                    for (let i = 0; i < index; i++) {
                        const prevBase = document.getElementById(`base-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                        if (prevBase) {
                            cumulativeBase += parseFloat(prevBase) * exchangeRates[currentCurrency];
                        }
                        
                        const prevTax = document.getElementById(`tax-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                        if (prevTax) {
                            previousTaxTotal += parseFloat(prevTax) * exchangeRates[currentCurrency];
                        }
                    }
                    
                    let totalCumulativeTax = 0;
                    if (cumulativeBase <= 110000) {
                        totalCumulativeTax = cumulativeBase * 0.15;
                    } else if (cumulativeBase <= 230000) {
                        totalCumulativeTax = 16500 + (cumulativeBase - 110000) * 0.20;
                    } else if (cumulativeBase <= 580000) {
                        totalCumulativeTax = 40500 + (cumulativeBase - 230000) * 0.27;
                    } else if (cumulativeBase <= 3000000) {
                        totalCumulativeTax = 135000 + (cumulativeBase - 580000) * 0.35;
                    } else {
                        totalCumulativeTax = 982000 + (cumulativeBase - 3000000) * 0.40;
                    }
                    
                    tax = Math.max(0, totalCumulativeTax - previousTaxTotal);
                } else {
                    if (base <= 110000) {
                        tax = base * 0.15;
                    } else if (base <= 230000) {
                        tax = 16500 + (base - 110000) * 0.20;
                    } else if (base <= 580000) {
                        tax = 40500 + (base - 230000) * 0.27;
                    } else if (base <= 3000000) {
                        tax = 135000 + (base - 580000) * 0.35;
                    } else {
                        tax = 982000 + (base - 3000000) * 0.40;
                    }
                }
                
                // Apply employee type and AGI
                tax = tax * getTaxMultiplier();
                if (advancedOptions.agi) {
                    const agiAmount = calculateAGI(base);
                    tax = Math.max(0, tax - agiAmount);
                }
                
                const stamp = brutEstimate * 0.00759;
                const calculatedNet = base - tax - stamp;
                
                const difference = targetNet - calculatedNet;
                
                // Check if close enough
                if (Math.abs(difference) < tolerance) {
                    break;
                }
                
                // Adjust estimate
                brutEstimate += difference * 1.3; // Multiply by factor for faster convergence
                iterations++;
            }
            
            // Now calculate all values with final brut
            const brut = brutEstimate;
            const sgk = brut * 0.14;
            const unemployment = brut * 0.01;
            const base = brut - sgk - unemployment;
            
            // Vergi hesaplama - T√úRKƒ∞YE DOƒûRU Y√ñNTEM: "Dilim ge√ßi≈üi tek tek"
            // √ñnceki aylarƒ±n k√ºm√ºlatif matrahƒ±nƒ± hesapla
            let previousCumulativeBase = 0;
            for (let i = 0; i < index; i++) {
                const prevBaseText = document.getElementById(`base-${i}`)?.textContent;
                if (prevBaseText) {
                    const prevBase = parseFloat(prevBaseText.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.'));
                    if (!isNaN(prevBase)) {
                        previousCumulativeBase += prevBase * exchangeRates[currentCurrency];
                    }
                }
            }
            
            // BU AYIN matrahƒ±nƒ±n dilim ge√ßi≈üini hesapla (incremental)
            const incrementalResult = calculateIncrementalTax(previousCumulativeBase, base);
            let tax = incrementalResult.tax;
            
            tax = tax * getTaxMultiplier();
            if (advancedOptions.agi) {
                const agiAmount = calculateAGI(base);
                tax = Math.max(0, tax - agiAmount);
            }
            
            // Calculate tax brackets for display
            const taxBrackets = incrementalResult.brackets;
            
            const stamp = brut * 0.00759;
            const net = base - tax - stamp;
            
            // Update display
            const rate = exchangeRates[currentCurrency];
            document.getElementById(`sgk-${index}`).textContent = formatCurrency(sgk / rate);
            document.getElementById(`unemployment-${index}`).textContent = formatCurrency(unemployment / rate);
            document.getElementById(`base-${index}`).textContent = formatCurrency(base / rate);
            
            // Vergi dilimlerini ayrƒ± s√ºtunlarda g√∂ster (br√ºtten nete aynƒ± ≈üekilde)
            document.getElementById(`tax15-${index}`).textContent = formatCurrency(taxBrackets.tax15 / rate);
            document.getElementById(`tax20-${index}`).textContent = formatCurrency(taxBrackets.tax20 / rate);
            document.getElementById(`tax27-${index}`).textContent = formatCurrency(taxBrackets.tax27 / rate);
            document.getElementById(`tax35-${index}`).textContent = formatCurrency(taxBrackets.tax35 / rate);
            document.getElementById(`tax40-${index}`).textContent = formatCurrency(taxBrackets.tax40 / rate);
            
            document.getElementById(`tax-${index}`).textContent = formatCurrency(tax / rate);
            document.getElementById(`stamp-${index}`).textContent = formatCurrency(stamp / rate);
            document.getElementById(`net-${index}`).innerHTML = `<strong>${formatCurrency(brut / rate)}</strong>`; // Show brut in net column
            
            if (advancedOptions.cumulative) {
                let cumulativeBaseForDisplay = base;
                for (let i = 0; i < index; i++) {
                    const prevBase = document.getElementById(`base-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                    if (prevBase) {
                        cumulativeBaseForDisplay += parseFloat(prevBase) * exchangeRates[currentCurrency];
                    }
                }
                document.getElementById(`cumulative-${index}`).textContent = formatCurrency(cumulativeBaseForDisplay / rate);
            }
            
            updateTotals();
        }

        // Update totals with all columns
        function updateTotals() {
            let totalBrut = 0, totalBonus = 0, totalSgk = 0, totalSgkDeduct = 0;
            let totalUnemployment = 0, totalBase = 0, totalCumulative = 0;
            let totalTax15 = 0, totalTax20 = 0, totalTax27 = 0, totalTax35 = 0, totalTax40 = 0;
            let totalAgi = 0, totalTaxDeduct = 0, totalTax = 0;
            let totalStampDeduct = 0, totalStamp = 0;
            let totalNetDeduct = 0, totalNetAdditions = 0, totalNet = 0;

            for (let i = 0; i < 12; i++) {
                const brutInput = document.getElementById(`brut-${i}`)?.value;
                if (brutInput) {
                    totalBrut += parseFloat(brutInput);

                    if (advancedOptions.bonus) {
                        const bonusVal = document.getElementById(`bonus-${i}`)?.value;
                        if (bonusVal) totalBonus += parseFloat(bonusVal);
                    }

                    const sgkText = document.getElementById(`sgk-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                    totalSgk += parseFloat(sgkText) || 0;

                    const unemploymentText = document.getElementById(`unemployment-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                    totalUnemployment += parseFloat(unemploymentText) || 0;

                    if (advancedOptions.sgkDeduct) {
                        const sgkDeductVal = document.getElementById(`sgk-deduct-${i}`)?.value;
                        if (sgkDeductVal) totalSgkDeduct += parseFloat(sgkDeductVal);
                    }

                    const baseText = document.getElementById(`base-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                    totalBase += parseFloat(baseText) || 0;

                    if (advancedOptions.cumulative) {
                        const cumulativeText = document.getElementById(`cumulative-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                        totalCumulative += parseFloat(cumulativeText) || 0;
                    }

                    // Vergi dilimleri toplamlarƒ±
                    const tax15Text = document.getElementById(`tax15-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                    totalTax15 += parseFloat(tax15Text) || 0;
                    
                    const tax20Text = document.getElementById(`tax20-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                    totalTax20 += parseFloat(tax20Text) || 0;
                    
                    const tax27Text = document.getElementById(`tax27-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                    totalTax27 += parseFloat(tax27Text) || 0;
                    
                    const tax35Text = document.getElementById(`tax35-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                    totalTax35 += parseFloat(tax35Text) || 0;
                    
                    const tax40Text = document.getElementById(`tax40-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                    totalTax40 += parseFloat(tax40Text) || 0;
                    
                    if (advancedOptions.agi) {
                        const agiText = document.getElementById(`agi-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                        totalAgi += parseFloat(agiText) || 0;
                    }

                    if (advancedOptions.taxDeduct) {
                        const taxDeductVal = document.getElementById(`tax-deduct-${i}`)?.value;
                        if (taxDeductVal) totalTaxDeduct += parseFloat(taxDeductVal);
                    }

                    const taxText = document.getElementById(`tax-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                    totalTax += parseFloat(taxText) || 0;

                    if (advancedOptions.stampDeduct) {
                        const stampDeductVal = document.getElementById(`stamp-deduct-${i}`)?.value;
                        if (stampDeductVal) totalStampDeduct += parseFloat(stampDeductVal);
                    }

                    const stampText = document.getElementById(`stamp-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                    totalStamp += parseFloat(stampText) || 0;

                    if (advancedOptions.netDeduct) {
                        const netDeductVal = document.getElementById(`net-deduct-${i}`)?.value;
                        if (netDeductVal) totalNetDeduct += parseFloat(netDeductVal);
                    }

                    if (advancedOptions.netAdditions) {
                        const netAddVal = document.getElementById(`net-additions-${i}`)?.value;
                        if (netAddVal) totalNetAdditions += parseFloat(netAddVal);
                    }

                    const netText = document.getElementById(`net-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                    totalNet += parseFloat(netText) || 0;
                }
            }

            // Update footer
            document.getElementById('footer-brut').innerHTML = `<strong>${formatCurrency(totalBrut)}</strong>`;
            
            if (advancedOptions.bonus) {
                document.getElementById('footer-bonus').innerHTML = `<strong>${formatCurrency(totalBonus)}</strong>`;
            }
            
            document.getElementById('footer-sgk').innerHTML = `<strong>${formatCurrency(totalSgk)}</strong>`;
            document.getElementById('footer-unemployment').innerHTML = `<strong>${formatCurrency(totalUnemployment)}</strong>`;
            
            if (advancedOptions.sgkDeduct) {
                document.getElementById('footer-sgk-deduct').innerHTML = `<strong>${formatCurrency(totalSgkDeduct)}</strong>`;
            }
            
            document.getElementById('footer-base').innerHTML = `<strong>${formatCurrency(totalBase)}</strong>`;

            if (advancedOptions.cumulative) {
                document.getElementById('footer-cumulative').innerHTML = `<strong>${formatCurrency(totalCumulative)}</strong>`;
            }
            
            // Vergi dilimi toplamlarƒ±
            document.getElementById('footer-tax15').innerHTML = `<strong>${formatCurrency(totalTax15)}</strong>`;
            document.getElementById('footer-tax20').innerHTML = `<strong>${formatCurrency(totalTax20)}</strong>`;
            document.getElementById('footer-tax27').innerHTML = `<strong>${formatCurrency(totalTax27)}</strong>`;
            document.getElementById('footer-tax35').innerHTML = `<strong>${formatCurrency(totalTax35)}</strong>`;
            document.getElementById('footer-tax40').innerHTML = `<strong>${formatCurrency(totalTax40)}</strong>`;
            
            if (advancedOptions.agi) {
                document.getElementById('footer-agi').innerHTML = `<strong>${formatCurrency(totalAgi)}</strong>`;
            }

            if (advancedOptions.taxDeduct) {
                document.getElementById('footer-tax-deduct').innerHTML = `<strong>${formatCurrency(totalTaxDeduct)}</strong>`;
            }

            document.getElementById('footer-tax').innerHTML = `<strong>${formatCurrency(totalTax)}</strong>`;
            
            if (advancedOptions.stampDeduct) {
                document.getElementById('footer-stamp-deduct').innerHTML = `<strong>${formatCurrency(totalStampDeduct)}</strong>`;
            }
            
            document.getElementById('footer-stamp').innerHTML = `<strong>${formatCurrency(totalStamp)}</strong>`;
            
            if (advancedOptions.netDeduct) {
                document.getElementById('footer-net-deduct').innerHTML = `<strong>${formatCurrency(totalNetDeduct)}</strong>`;
            }

            if (advancedOptions.netAdditions) {
                document.getElementById('footer-net-additions').innerHTML = `<strong>${formatCurrency(totalNetAdditions)}</strong>`;
            }
            
            document.getElementById('footer-net').innerHTML = `<strong>${formatCurrency(totalNet)}</strong>`;

            // Update summary cards
            document.getElementById('total-brut').textContent = formatCurrency(totalBrut);
            document.getElementById('total-net').textContent = formatCurrency(totalNet);
            document.getElementById('total-deductions').textContent = formatCurrency(totalSgk + totalUnemployment + totalTax + totalStamp);
            document.getElementById('avg-net').textContent = formatCurrency(totalNet / 12);
        }

        // Format currency
        function formatCurrency(value) {
            return value.toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + currencySymbol;
        }

        // Toggle dropdown
        function toggleDropdown(id) {
            const dropdown = document.getElementById(id);
            const allDropdowns = document.querySelectorAll('.dropdown-content');
            
            allDropdowns.forEach(d => {
                if (d.id !== id) d.classList.remove('show');
            });
            
            dropdown.classList.toggle('show');
        }

        // Select currency
        function selectCurrency(currency, symbol) {
            currentCurrency = currency;
            currencySymbol = symbol;
            document.getElementById('currency-text').textContent = currency;
            
            // Remove all selected classes
            document.querySelectorAll('#currency-select .dropdown-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Add selected class to clicked item
            event.target.classList.add('selected');
            
            toggleDropdown('currency-select');
            
            // Recalculate all rows
            for (let i = 0; i < 12; i++) {
                calculateRow(i);
            }
        }

        // Select year
        function selectYear(year) {
            currentYear = year;
            document.getElementById('year-text').textContent = year;
            
            const yearData = getYearData(year);
            
            // Gelecek yƒ±l projeksiyonu uyarƒ±sƒ±
            if (yearData.projected) {
                const today = new Date();
                if (today.getFullYear() < year || (today.getFullYear() === year && today.getMonth() === 0)) {
                    console.log(`${year} yƒ±lƒ± verileri tahmine dayalƒ±dƒ±r. 1 Ocak ${year} tarihinde otomatik g√ºncellenecektir.`);
                    // Kullanƒ±cƒ±ya bildirim g√∂ster
                    showYearProjectionWarning(year);
                }
            }
            
            document.querySelectorAll('#year-select .dropdown-item').forEach(item => {
                item.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            toggleDropdown('year-select');
            
            // T√ºm hesaplamalarƒ± yeniden yap
            initTable();
            
            // Manuel d√ºzenleme takibini ba≈ülat
            setTimeout(() => {
                initManualEditTracking();
            }, 100);
            
            for (let i = 0; i < 12; i++) {
                calculateRow(i);
            }
        }
        
        // Yƒ±l projeksiyonu uyarƒ±sƒ±
        function showYearProjectionWarning(year) {
            const existingWarning = document.getElementById('year-projection-warning');
            if (existingWarning) existingWarning.remove();
            
            const warning = document.createElement('div');
            warning.id = 'year-projection-warning';
            warning.style.cssText = 'background: #fef3c7; color: #92400e; padding: 12px 20px; border-radius: 8px; margin: 15px 0; text-align: center; font-size: 0.9em;';
            warning.innerHTML = `<strong>‚ö†Ô∏è Dikkat:</strong> ${year} yƒ±lƒ± verileri tahminidir ve 1 Ocak ${year} tarihinde g√ºncellenecektir.`;
            
            const toolbar = document.querySelector('.toolbar');
            if (toolbar) {
                toolbar.after(warning);
                
                // 5 saniye sonra kaldƒ±r
                setTimeout(() => warning.remove(), 5000);
            }
        }

        // Select direction
        function selectDirection(direction) {
            calculationDirection = direction;
            
            // Sayfa yenileme ile tabloyu tamamen sƒ±fƒ±rla
            location.reload();
        }

        // Select view
        function selectView(view) {
            document.getElementById('view-text').textContent = view === 'table' ? 'Tablo' : 'Kart G√∂r√ºn√ºm√º';
            
            document.querySelectorAll('#view-mode .dropdown-item').forEach(item => {
                item.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // Toggle views
            if (view === 'card') {
                document.getElementById('table-view').style.display = 'none';
                document.getElementById('card-view').style.display = 'grid';
                initCardView();
            } else {
                document.getElementById('table-view').style.display = 'block';
                document.getElementById('card-view').style.display = 'none';
            }
            
            toggleDropdown('view-mode');
        }
        
        // Initialize card view
        function initCardView() {
            const cardContainer = document.getElementById('card-view');
            cardContainer.innerHTML = '';
            
            months.forEach((month, index) => {
                const card = document.createElement('div');
                card.className = 'month-card';
                
                const brutInput = document.getElementById(`brut-${index}`)?.value || '';
                const sgk = document.getElementById(`sgk-${index}`)?.textContent || '0‚Ç∫';
                const unemployment = document.getElementById(`unemployment-${index}`)?.textContent || '0‚Ç∫';
                const tax = document.getElementById(`tax-${index}`)?.textContent || '0‚Ç∫';
                const stamp = document.getElementById(`stamp-${index}`)?.textContent || '0‚Ç∫';
                const net = document.getElementById(`net-${index}`)?.textContent || '0‚Ç∫';
                
                card.innerHTML = `
                    <div class="month-card-header">
                        <div class="month-card-title">${month} '25</div>
                        <div class="month-card-number">${index + 1}</div>
                    </div>
                    
                    <div class="month-card-input-group">
                        <label class="month-card-label">Maa≈ü</label>
                        <input type="number" class="month-card-input" 
                               value="${brutInput}" 
                               placeholder="30.000,00"
                               onchange="updateCardFromInput(${index}, this.value)">
                    </div>
                    
                    <div class="month-card-detail">
                        <span class="month-card-detail-label">√áalƒ±≈üan SGK Primi</span>
                        <span class="month-card-detail-value sgk" id="card-sgk-${index}">${sgk}</span>
                    </div>
                    
                    <div class="month-card-detail">
                        <span class="month-card-detail-label">√áalƒ±≈üan ƒ∞≈üsizlik Sigortasƒ±</span>
                        <span class="month-card-detail-value unemployment" id="card-unemployment-${index}">${unemployment}</span>
                    </div>
                    
                    <div class="month-card-detail">
                        <span class="month-card-detail-label">Damga Vergisi</span>
                        <span class="month-card-detail-value stamp" id="card-stamp-${index}">${stamp}</span>
                    </div>
                    
                    <div class="month-card-detail">
                        <span class="month-card-detail-label">Gelir Vergisi</span>
                        <span class="month-card-detail-value tax" id="card-tax-${index}">${tax}</span>
                    </div>
                    
                    <div class="month-card-footer">
                        <div class="month-card-net">
                            <span class="month-card-net-label">Net √úcret</span>
                            <span class="month-card-net-value" id="card-net-${index}">${net}</span>
                        </div>
                        
                        <div class="month-card-maa≈ü">
                            <span class="month-card-maa≈ü-label">Maa≈ü</span>
                            <span class="month-card-maa≈ü-value" id="card-maas-${index}">${net}</span>
                        </div>
                    </div>
                `;
                
                cardContainer.appendChild(card);
            });
        }
        
        // Update card from input
        function updateCardFromInput(index, value) {
            // Update the hidden table input
            const tableInput = document.getElementById(`brut-${index}`);
            if (tableInput) {
                tableInput.value = value;
                calculateRow(index);
                
                // Update card display
                setTimeout(() => {
                    const sgk = document.getElementById(`sgk-${index}`)?.textContent || '0‚Ç∫';
                    const unemployment = document.getElementById(`unemployment-${index}`)?.textContent || '0‚Ç∫';
                    const tax = document.getElementById(`tax-${index}`)?.textContent || '0‚Ç∫';
                    const stamp = document.getElementById(`stamp-${index}`)?.textContent || '0‚Ç∫';
                    const net = document.getElementById(`net-${index}`)?.textContent || '0‚Ç∫';
                    
                    document.getElementById(`card-sgk-${index}`).textContent = sgk;
                    document.getElementById(`card-unemployment-${index}`).textContent = unemployment;
                    document.getElementById(`card-tax-${index}`).textContent = tax;
                    document.getElementById(`card-stamp-${index}`).textContent = stamp;
                    document.getElementById(`card-net-${index}`).textContent = net;
                    document.getElementById(`card-maas-${index}`).textContent = net;
                }, 100);
            }
        }

        // Toggle advanced option and rebuild table
        function toggleAdvancedOption(option, checked) {
            advancedOptions[option] = checked;
            
            // Show/hide AGI settings
            if (option === 'agi') {
                const agiSettings = document.getElementById('agi-settings');
                if (agiSettings) {
                    agiSettings.style.display = checked ? 'block' : 'none';
                }
                
                // Update marital status and child count from inputs
                maritalStatus = document.getElementById('marital-status')?.value || 'single';
                childCount = parseInt(document.getElementById('child-count')?.value || '0');
                
                // Recalculate without rebuilding table
                for (let i = 0; i < 12; i++) {
                    calculateRow(i);
                }
                return;
            }
            
            // Save current values
            const savedValues = {};
            for (let i = 0; i < 12; i++) {
                savedValues[i] = {
                    brut: document.getElementById(`brut-${i}`)?.value || '',
                    bonus: document.getElementById(`bonus-${i}`)?.value || '',
                    sgkDeduct: document.getElementById(`sgk-deduct-${i}`)?.value || '',
                    taxDeduct: document.getElementById(`tax-deduct-${i}`)?.value || '',
                    stampDeduct: document.getElementById(`stamp-deduct-${i}`)?.value || '',
                    netDeduct: document.getElementById(`net-deduct-${i}`)?.value || '',
                    netAdditions: document.getElementById(`net-additions-${i}`)?.value || ''
                };
            }

            // Rebuild table
            initTable();
            
            // Manuel d√ºzenleme takibini ba≈ülat
            setTimeout(() => {
                initManualEditTracking();
            }, 100);

            // Restore values
            for (let i = 0; i < 12; i++) {
                if (savedValues[i].brut) {
                    document.getElementById(`brut-${i}`).value = savedValues[i].brut;
                }
                if (savedValues[i].bonus && document.getElementById(`bonus-${i}`)) {
                    document.getElementById(`bonus-${i}`).value = savedValues[i].bonus;
                }
                if (savedValues[i].sgkDeduct && document.getElementById(`sgk-deduct-${i}`)) {
                    document.getElementById(`sgk-deduct-${i}`).value = savedValues[i].sgkDeduct;
                }
                if (savedValues[i].taxDeduct && document.getElementById(`tax-deduct-${i}`)) {
                    document.getElementById(`tax-deduct-${i}`).value = savedValues[i].taxDeduct;
                }
                if (savedValues[i].stampDeduct && document.getElementById(`stamp-deduct-${i}`)) {
                    document.getElementById(`stamp-deduct-${i}`).value = savedValues[i].stampDeduct;
                }
                if (savedValues[i].netDeduct && document.getElementById(`net-deduct-${i}`)) {
                    document.getElementById(`net-deduct-${i}`).value = savedValues[i].netDeduct;
                }
                if (savedValues[i].netAdditions && document.getElementById(`net-additions-${i}`)) {
                    document.getElementById(`net-additions-${i}`).value = savedValues[i].netAdditions;
                }
                calculateRow(i);
            }

            // Toggle footer visibility
            const tfoot = document.querySelector('#monthly-table tfoot');
            if (tfoot) {
                tfoot.style.display = advancedOptions.totals ? '' : 'none';
            }
        }

        // Toggle side panel
        function toggleSidePanel() {
            document.getElementById('side-panel').classList.toggle('show');
        }

        // Export to PDF with dynamic columns
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape'); // Landscape for more columns

            // T√ºrk√ße karakter desteƒüi i√ßin font ayarlarƒ±
            doc.setFont("helvetica");
            doc.setLanguage("tr");

            // Add title
            doc.setFontSize(16);
            doc.text('Maasini Hesapla by Goksel - Yillik Maas Hesaplama', 14, 15);
            doc.setFontSize(10);
            doc.text(`Yil: ${currentYear} | Para Birimi: ${currentCurrency}`, 14, 22);

            // Build dynamic headers - T√ºrk√ße karaktersiz
            const headers = ['Ay', 'Brut'];
            if (advancedOptions.bonus) headers.push('Ikramiye/Prim');
            headers.push('SGK');
            if (advancedOptions.sgkDeduct) headers.push('SGK Dusulen');
            headers.push('Issizlik', 'Matrah');
            if (advancedOptions.cumulative) headers.push('Kumulatif');
            headers.push('Vergi Dilimi', 'Toplam Gelir V.');
            if (advancedOptions.taxDeduct) headers.push('Gelir V. Dusulen');
            headers.push('Damga V.');
            if (advancedOptions.stampDeduct) headers.push('Damga V. Dusulen');
            if (advancedOptions.netDeduct) headers.push('Netten Dusulen');
            if (advancedOptions.netAdditions) headers.push('Net Ilaveler');
            headers.push('Net');

            // Prepare table data
            const monthsLatin = [
                'Ocak', 'Subat', 'Mart', 'Nisan', 'Mayis', 'Haziran',
                'Temmuz', 'Agustos', 'Eylul', 'Ekim', 'Kasim', 'Aralik'
            ];
            
            const tableData = [];
            for (let i = 0; i < 12; i++) {
                const row = [`${i + 1}. ${monthsLatin[i]}`];
                
                row.push(document.getElementById(`brut-${i}`)?.value || '0');
                
                if (advancedOptions.bonus) {
                    row.push(document.getElementById(`bonus-${i}`)?.value || '0');
                }
                
                row.push(document.getElementById(`sgk-${i}`)?.textContent.replace(currencySymbol, '') || '0');
                
                if (advancedOptions.sgkDeduct) {
                    row.push(document.getElementById(`sgk-deduct-${i}`)?.value || '0');
                }
                
                row.push(document.getElementById(`unemployment-${i}`)?.textContent.replace(currencySymbol, '') || '0');
                row.push(document.getElementById(`base-${i}`)?.textContent.replace(currencySymbol, '') || '0');
                
                if (advancedOptions.cumulative) {
                    row.push(document.getElementById(`cumulative-${i}`)?.textContent.replace(currencySymbol, '') || '0');
                }
                
                // Vergi dilimi - 5 ayrƒ± s√ºtundan hangi dilimlerin kullanƒ±ldƒ±ƒüƒ±nƒ± belirle
                let activeBrackets = [];
                const tax15Val = document.getElementById(`tax15-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                const tax20Val = document.getElementById(`tax20-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                const tax27Val = document.getElementById(`tax27-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                const tax35Val = document.getElementById(`tax35-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                const tax40Val = document.getElementById(`tax40-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                
                if (parseFloat(tax15Val) > 0) activeBrackets.push('%15');
                if (parseFloat(tax20Val) > 0) activeBrackets.push('%20');
                if (parseFloat(tax27Val) > 0) activeBrackets.push('%27');
                if (parseFloat(tax35Val) > 0) activeBrackets.push('%35');
                if (parseFloat(tax40Val) > 0) activeBrackets.push('%40');
                
                const bracketText = activeBrackets.length > 0 ? activeBrackets.join(' ') : '-';
                row.push(bracketText);
                
                row.push(document.getElementById(`tax-${i}`)?.textContent.replace(currencySymbol, '') || '0');
                
                if (advancedOptions.taxDeduct) {
                    row.push(document.getElementById(`tax-deduct-${i}`)?.value || '0');
                }
                
                row.push(document.getElementById(`stamp-${i}`)?.textContent.replace(currencySymbol, '') || '0');
                
                if (advancedOptions.stampDeduct) {
                    row.push(document.getElementById(`stamp-deduct-${i}`)?.value || '0');
                }
                
                if (advancedOptions.netDeduct) {
                    row.push(document.getElementById(`net-deduct-${i}`)?.value || '0');
                }
                
                if (advancedOptions.netAdditions) {
                    row.push(document.getElementById(`net-additions-${i}`)?.value || '0');
                }
                
                row.push(document.getElementById(`net-${i}`)?.textContent.replace(currencySymbol, '') || '0');
                
                tableData.push(row);
            }

            // Add totals row if enabled
            if (advancedOptions.totals) {
                const totalRow = ['TOPLAM'];
                totalRow.push(document.getElementById('footer-brut')?.textContent.replace(currencySymbol, '') || '0');
                
                if (advancedOptions.bonus) {
                    totalRow.push(document.getElementById('footer-bonus')?.textContent.replace(currencySymbol, '') || '0');
                }
                
                totalRow.push(document.getElementById('footer-sgk')?.textContent.replace(currencySymbol, '') || '0');
                
                if (advancedOptions.sgkDeduct) {
                    totalRow.push(document.getElementById('footer-sgk-deduct')?.textContent.replace(currencySymbol, '') || '0');
                }
                
                totalRow.push(document.getElementById('footer-unemployment')?.textContent.replace(currencySymbol, '') || '0');
                totalRow.push(document.getElementById('footer-base')?.textContent.replace(currencySymbol, '') || '0');
                
                if (advancedOptions.cumulative) {
                    totalRow.push(document.getElementById('footer-cumulative')?.textContent.replace(currencySymbol, '') || '0');
                }
                
                totalRow.push('-'); // Vergi dilimi toplam i√ßin bo≈ü
                
                totalRow.push(document.getElementById('footer-tax')?.textContent.replace(currencySymbol, '') || '0');
                
                if (advancedOptions.taxDeduct) {
                    totalRow.push(document.getElementById('footer-tax-deduct')?.textContent.replace(currencySymbol, '') || '0');
                }
                
                totalRow.push(document.getElementById('footer-stamp')?.textContent.replace(currencySymbol, '') || '0');
                
                if (advancedOptions.stampDeduct) {
                    totalRow.push(document.getElementById('footer-stamp-deduct')?.textContent.replace(currencySymbol, '') || '0');
                }
                
                if (advancedOptions.netDeduct) {
                    totalRow.push(document.getElementById('footer-net-deduct')?.textContent.replace(currencySymbol, '') || '0');
                }
                
                if (advancedOptions.netAdditions) {
                    totalRow.push(document.getElementById('footer-net-additions')?.textContent.replace(currencySymbol, '') || '0');
                }
                
                totalRow.push(document.getElementById('footer-net')?.textContent.replace(currencySymbol, '') || '0');
                
                tableData.push(totalRow);
            }

            doc.autoTable({
                startY: 30,
                head: [headers],
                body: tableData,
                theme: 'grid',
                headStyles: { fillColor: [99, 102, 241], fontSize: 7 },
                bodyStyles: { fontSize: 6 },
                footStyles: { fillColor: [241, 245, 249], textColor: [30, 41, 59], fontStyle: 'bold' }
            });

            doc.save(`maas-hesaplama-${currentYear}.pdf`);
        }

        // Export to Excel with dynamic columns
        function exportToExcel() {
            const wb = XLSX.utils.book_new();
            
            // Build dynamic headers
            const headers = ['Ay', 'Br√ºt √úcret'];
            if (advancedOptions.bonus) headers.push('ƒ∞kramiye/Prim/Ek √ñdemeler');
            headers.push('SGK ƒ∞≈ü√ßi');
            if (advancedOptions.sgkDeduct) headers.push('SGK Matrahƒ±ndan D√º≈ü√ºlen');
            headers.push('ƒ∞≈üsizlik');
            headers.push('Vergi Matrahƒ±');
            if (advancedOptions.cumulative) headers.push('K√ºm√ºlatif Matrah');
            headers.push('Vergi Dilimi', 'Toplam Gelir Vergisi');
            if (advancedOptions.taxDeduct) headers.push('Gelir V. Matrahƒ±ndan D√º≈ü√ºlen');
            headers.push('Damga Vergisi');
            if (advancedOptions.stampDeduct) headers.push('Damga V. Matrahƒ±ndan D√º≈ü√ºlen');
            if (advancedOptions.netDeduct) headers.push('Netten D√º≈ü√ºlen (BES vb.)');
            if (advancedOptions.netAdditions) headers.push('Net ƒ∞laveler');
            headers.push('Net √úcret');

            const tableData = [headers];

            for (let i = 0; i < 12; i++) {
                const row = [`${i + 1}. ${months[i]}`];
                
                const brutVal = document.getElementById(`brut-${i}`)?.value || '0';
                row.push(parseFloat(brutVal));
                
                if (advancedOptions.bonus) {
                    const bonusVal = document.getElementById(`bonus-${i}`)?.value || '0';
                    row.push(parseFloat(bonusVal));
                }
                
                const sgkText = document.getElementById(`sgk-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                row.push(parseFloat(sgkText) || 0);
                
                if (advancedOptions.sgkDeduct) {
                    const sgkDeductVal = document.getElementById(`sgk-deduct-${i}`)?.value || '0';
                    row.push(parseFloat(sgkDeductVal));
                }
                
                const unemploymentText = document.getElementById(`unemployment-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                row.push(parseFloat(unemploymentText) || 0);
                
                const baseText = document.getElementById(`base-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                row.push(parseFloat(baseText) || 0);
                
                if (advancedOptions.cumulative) {
                    const cumulativeText = document.getElementById(`cumulative-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                    row.push(parseFloat(cumulativeText) || 0);
                }
                
                // Vergi dilimi - 5 ayrƒ± s√ºtundan hangi dilimlerin kullanƒ±ldƒ±ƒüƒ±nƒ± belirle
                let activeBracketsExcel = [];
                const tax15ValExcel = document.getElementById(`tax15-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                const tax20ValExcel = document.getElementById(`tax20-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                const tax27ValExcel = document.getElementById(`tax27-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                const tax35ValExcel = document.getElementById(`tax35-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                const tax40ValExcel = document.getElementById(`tax40-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                
                if (parseFloat(tax15ValExcel) > 0) activeBracketsExcel.push('%15');
                if (parseFloat(tax20ValExcel) > 0) activeBracketsExcel.push('%20');
                if (parseFloat(tax27ValExcel) > 0) activeBracketsExcel.push('%27');
                if (parseFloat(tax35ValExcel) > 0) activeBracketsExcel.push('%35');
                if (parseFloat(tax40ValExcel) > 0) activeBracketsExcel.push('%40');
                
                const bracketTextExcel = activeBracketsExcel.length > 0 ? activeBracketsExcel.join(' ') : '-';
                row.push(bracketTextExcel);
                
                const taxText = document.getElementById(`tax-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                row.push(parseFloat(taxText) || 0);
                
                if (advancedOptions.taxDeduct) {
                    const taxDeductVal = document.getElementById(`tax-deduct-${i}`)?.value || '0';
                    row.push(parseFloat(taxDeductVal));
                }
                
                const stampText = document.getElementById(`stamp-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                row.push(parseFloat(stampText) || 0);
                
                if (advancedOptions.stampDeduct) {
                    const stampDeductVal = document.getElementById(`stamp-deduct-${i}`)?.value || '0';
                    row.push(parseFloat(stampDeductVal));
                }
                
                if (advancedOptions.netDeduct) {
                    const netDeductVal = document.getElementById(`net-deduct-${i}`)?.value || '0';
                    row.push(parseFloat(netDeductVal));
                }
                
                if (advancedOptions.netAdditions) {
                    const netAddVal = document.getElementById(`net-additions-${i}`)?.value || '0';
                    row.push(parseFloat(netAddVal));
                }
                
                const netText = document.getElementById(`net-${i}`)?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                row.push(parseFloat(netText) || 0);
                
                tableData.push(row);
            }

            // Add totals if enabled
            if (advancedOptions.totals) {
                const totalRow = ['TOPLAM'];
                
                const totalBrutText = document.getElementById('footer-brut')?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                totalRow.push(parseFloat(totalBrutText) || 0);
                
                if (advancedOptions.bonus) {
                    const totalBonusText = document.getElementById('footer-bonus')?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                    totalRow.push(parseFloat(totalBonusText) || 0);
                }
                
                const totalSgkText = document.getElementById('footer-sgk')?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                totalRow.push(parseFloat(totalSgkText) || 0);
                
                if (advancedOptions.sgkDeduct) {
                    const totalSgkDeductText = document.getElementById('footer-sgk-deduct')?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                    totalRow.push(parseFloat(totalSgkDeductText) || 0);
                }
                
                const totalUnemploymentText = document.getElementById('footer-unemployment')?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                totalRow.push(parseFloat(totalUnemploymentText) || 0);
                
                const totalBaseText = document.getElementById('footer-base')?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                totalRow.push(parseFloat(totalBaseText) || 0);
                
                if (advancedOptions.cumulative) {
                    const totalCumulativeText = document.getElementById('footer-cumulative')?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                    totalRow.push(parseFloat(totalCumulativeText) || 0);
                }
                
                totalRow.push('-'); // Vergi dilimi toplam i√ßin bo≈ü
                
                const totalTaxText = document.getElementById('footer-tax')?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                totalRow.push(parseFloat(totalTaxText) || 0);
                
                if (advancedOptions.taxDeduct) {
                    const totalTaxDeductText = document.getElementById('footer-tax-deduct')?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                    totalRow.push(parseFloat(totalTaxDeductText) || 0);
                }
                
                const totalStampText = document.getElementById('footer-stamp')?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                totalRow.push(parseFloat(totalStampText) || 0);
                
                if (advancedOptions.stampDeduct) {
                    const totalStampDeductText = document.getElementById('footer-stamp-deduct')?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                    totalRow.push(parseFloat(totalStampDeductText) || 0);
                }
                
                if (advancedOptions.netDeduct) {
                    const totalNetDeductText = document.getElementById('footer-net-deduct')?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                    totalRow.push(parseFloat(totalNetDeductText) || 0);
                }
                
                if (advancedOptions.netAdditions) {
                    const totalNetAddText = document.getElementById('footer-net-additions')?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                    totalRow.push(parseFloat(totalNetAddText) || 0);
                }
                
                const totalNetText = document.getElementById('footer-net')?.textContent.replace(currencySymbol, '').replace(/\./g, '').replace(',', '.');
                totalRow.push(parseFloat(totalNetText) || 0);
                
                tableData.push(totalRow);
            }

            const ws = XLSX.utils.aoa_to_sheet(tableData);
            
            // Set column widths dynamically
            const colWidths = headers.map(() => ({ wch: 15 }));
            ws['!cols'] = colWidths;

            XLSX.utils.book_append_sheet(wb, ws, currentYear.toString());
            XLSX.writeFile(wb, `maas-hesaplama-${currentYear}.xlsx`);
        }

        // Close dropdowns when clicking outside
        window.onclick = function(event) {
            if (!event.target.matches('.dropdown-btn') && !event.target.closest('.dropdown-btn')) {
                const dropdowns = document.getElementsByClassName('dropdown-content');
                for (let i = 0; i < dropdowns.length; i++) {
                    dropdowns[i].classList.remove('show');
                }
            }
        };

        // Initialize
        initTable();
        
        // Manuel d√ºzenleme takibini ba≈ülat
        setTimeout(() => {
            initManualEditTracking();
        }, 100);
    </script>

    <!-- Yorum Sistemi -->
    <div class="comparison-table" style="margin-top: 30px;">
        <h2 style="margin-bottom: 20px;">üí¨ Yorumlar</h2>
        <script src="https://giscus.app/client.js"
                data-repo="Goksel0167/maas-hesaplama-platformu"
                data-repo-id="R_kgDOQta-lA"
                data-category="General"
                data-category-id="DIC_kwDOQta-lM4C0KJO"
                data-mapping="pathname"
                data-strict="0"
                data-reactions-enabled="1"
                data-emit-metadata="0"
                data-input-position="bottom"
                data-theme="preferred_color_scheme"
                data-lang="tr"
                crossorigin="anonymous"
                async>
        </script>
    </div>

</body>
</html>